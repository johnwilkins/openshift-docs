// This is included in the following assemblies:
//
// installing/installing_bare_metal_ipi/ipi-install-configuration-files.adoc

:_mod-docs-content-type: REFERENCE
[id='bmc-addressing_{context}']
= BMC addressing

Most vendors support Baseboard Management Controller (BMC) addressing with the Intelligent Platform Management Interface (IPMI). IPMI does not encrypt communications. It is suitable for use within a data center over a secured or dedicated management network. Check with your vendor to see if they support Redfish network boot. Redfish delivers simple and secure management for converged, hybrid IT and the Software Defined Data Center (SDDC). Redfish is human readable and machine capable, and leverages common internet and web services standards to expose information directly to the modern tool chain. If your hardware does not support Redfish network boot, use IPMI.

You can modify the BMC address during installation while the node is in the `Registering` state. If you need to modify the BMC address after the node leaves the `Registering` state, or if you need to modify the BMC credentials, you must disconnect the node from Ironic, edit the `BareMetalHost` resource, and reconnect the node to Ironic. See the _Additional resources_ section for details.

[discrete]
== IPMI

Hosts using IPMI use the `ipmi://<out-of-band-ip>:<port>` address format, which defaults to port `623` if not specified. The following example demonstrates an IPMI configuration within the `install-config.yaml` file.

[source,yaml]
----
platform:
  baremetal:
    hosts:
      - name: openshift-master-0
        role: master
        bmc:
          address: ipmi://<out-of-band-ip>
          username: <user>
          password: <password>
----

[IMPORTANT]
====
The `provisioning` network is required when PXE booting using IPMI for BMC addressing. It is not possible to PXE boot hosts without a `provisioning` network. If you deploy without a `provisioning` network, you must use a virtual media BMC addressing option such as `redfish-virtualmedia` or `idrac-virtualmedia`. See "Redfish virtual media for HPE iLO" in the "BMC addressing for HPE iLO" section or "Redfish virtual media for Dell iDRAC" in the "BMC addressing for Dell iDRAC" section for additional details.
====

[discrete]
== Redfish network boot

To enable Redfish, use `redfish://` or `redfish+http://` to disable TLS. The installer requires both the hostname or the IP address and the path to the system ID. The following example demonstrates a Redfish configuration within the `install-config.yaml` file.

[source,yaml]
----
platform:
  baremetal:
    hosts:
      - name: openshift-master-0
        role: master
        bmc:
          address: redfish://<out-of-band-ip>/redfish/v1/Systems/1
          username: <user>
          password: <password>
----

While it is recommended to have a certificate of authority for the out-of-band management addresses, you must include `disableCertificateVerification: True` in the `bmc` configuration if using self-signed certificates. The following example demonstrates a Redfish configuration using the `disableCertificateVerification: True` configuration parameter within the `install-config.yaml` file.

[source,yaml]
----
platform:
  baremetal:
    hosts:
      - name: openshift-master-0
        role: master
        bmc:
          address: redfish://<out-of-band-ip>/redfish/v1/Systems/1
          username: <user>
          password: <password>
          disableCertificateVerification: True
----

[discrete]
== Redfish APIs

The installation program calls several Redfish API endpoints on the BMC when using installer-provisioned infrastructure on bare metal.

[IMPORTANT]
====
Ensure that your BMC supports all of the Redfish APIs before installation.
====

.Procedure

. Set the BMC user name by running the following command:
+
[source,terminal]
----
$ export USER=<username> <1>
----
<1> Replace `<username>` with the name of the BMC user.

. Set the BMC password by running the following command:
+
[source,terminal]
----
$ export PASS=<password> <1>
----
<1> Replace `<password>` with the password of the BMC user.

. Set the IP address of the BMC by running the following command:
+
[source,terminal]
----
$ export SERVER=<ip_address> <1>
----
<1> Replace `<ip_address>` with the IP address of the BMC.

. Set the ID of the system by running the following command:
+
[source,terminal]
----
$ export SystemID=<system_id> <1>
----
<1> Replace `<system_id>` with the system ID. For example, `System.Embedded.1` or `1`. See the following vendor-specific BMC sections for details.

.List of Redfish APIs:

* Check `power on` support by running the following command:
+
[source,terminal]
----
$ curl -u $USER:$PASS -X POST -H'Content-Type: application/json' -H'Accept: application/json' -d '{"ResetType": "On"}' https://$SERVER/redfish/v1/Systems/$SystemID/Actions/ComputerSystem.Reset
----

* Check `power off` support by running the following command:
+
[source,terminal]
----
$ curl -u $USER:$PASS -X POST -H'Content-Type: application/json' -H'Accept: application/json' -d '{"ResetType": "ForceOff"}' https://$SERVER/redfish/v1/Systems/$SystemID/Actions/ComputerSystem.Reset
----
* Check temporary boot using `pxe` by running the following command:
+
[source,terminal]
----
$ curl -u $USER:$PASS -X PATCH -H "Content-Type: application/json"  https://$Server/redfish/v1/Systems/$SystemID/ -d '{"Boot": {"BootSourceOverrideTarget": "pxe", "BootSourceOverrideEnabled": "Once"}}
----

* Check the ability to set the BIOS boot mode using `Legacy` or `UEFI` by running the following command:
+
[source,terminal]
----
$ curl -u $USER:$PASS -X PATCH -H "Content-Type: application/json"  https://$Server/redfish/v1/Systems/$SystemID/ -d '{"Boot": {"BootSourceOverrideMode":"UEFI"}}
----

.List of Redfish virtual media APIs:

* Check the ability to set the temporary boot device using `cd` or `dvd` by running the following command:
+
[source,terminal]
----
$ curl -u $USER:$PASS -X PATCH -H "Content-Type: application/json" https://$Server/redfish/v1/Systems/$SystemID/ -d '{"Boot": {"BootSourceOverrideTarget": "cd", "BootSourceOverrideEnabled": "Once"}}'
----

* Check the ability to mount virtual media by running the following command:
+
[source,terminal]
----
$ curl -u $USER:$PASS -X PATCH -H "Content-Type: application/json" -H "If-Match: *" https://$Server/redfish/v1/Managers/$ManagerID/VirtualMedia/$VmediaId -d '{"Image": "https://example.com/test.iso", "TransferProtocolType": "HTTPS", "UserName": "", "Password":""}'
----

[NOTE]
====
The `PowerOn` and `PowerOff` commands for Redfish APIs are the same for the Redfish virtual media APIs.
====

[IMPORTANT]
====
`HTTPS` and `HTTP` are the only supported parameter types for `TransferProtocolTypes`.
====
